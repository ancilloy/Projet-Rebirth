<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
<!--JaajaScript-->
    <script>

    //Génère une couleur aléatoire pour colormix
        let colormix = ""
        function randomColor() {
            let colormix = "#"+((1<<24)*Math.random()|0).toString(16)
            return colormix
        }

    //Traite le nombre de cases cochées du tableau.
        let dead = 0
        function deadpeople() {
        //Compte le nombre de morts
            let j = 0
            for (i = dead; i < 16; i++){
                if(document.getElementById("Live_"+i).checked == true){
                    j++
                }
            }
        //Message en réaction
            if (j == 0) {
                alert("À tous les étudiants. Aujourd'hui, personne n'est mort. Quel dommage.")
            }
            else if (j == 1) {
                alert ("À tous les étudiants. Aujourd'hui, une personne est morte. Quelle chance.")
            }
            else if (j == 6) {
                alert ("Au premier crépuscule, les six choisis par la clé seront sacrifiés.")
            }
            else {
                alert("À tous les étudiants. Aujourd'hui, " + j + " personnes sont mortes. Ou peut-être hier, je ne sais plus.")
            }
        }
        
    //Récupération des données du .JSON
        async function fetchData() {
            try {
                const response = await fetch("https://ancilloy.github.io/Projet-Rebirth/dangandata.json");
                dangandata = await response.json();
                displayData(dangandata);
            } catch (error) {
                console.error('Oh no ! :', error);
            }
        }

    //Affichage des données du .JSON
        function displayData(dangandata) {
            const dataList = document.getElementById('alpha');
            dataList.innerHTML = '';

            let row;
            dangandata.forEach((character, index) => {
            //Gestion du Tableau
                if (index % 4 === 0) {
                    row = document.createElement('tr');
                    dataList.appendChild(row);
                }
                const cell = document.createElement('td');

            //Importation de l'image
                const danganImage = document.createElement('img');
                danganImage.src = character.url;

            //Gestionnaire des fonctions sur clicks d'images
                danganImage.addEventListener('click', () => {
                    handleImageClick(character);
                });

            //Création d'une checkbox + ID
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';    
                checkbox.id = `Live_${index}`;
                
            //Assemblage dans la cellule
                cell.appendChild(danganImage);
                cell.appendChild(document.createElement('br'));
                cell.appendChild(checkbox);
                row.appendChild(cell);
            });
        }

    //Fonctions en cliquant sur perso X.
        function handleImageClick(character, index) {
        //Himiko change la couleur de fond.
            if ((character.name) === "Himiko Yumeno") {
                document.body.style.backgroundColor = randomColor(colormix);
            }
        //Tsumugi renvoie à "electrolithe".
            if (character.name === "Tsumugi Shirogane") {
                window.location.href = "electrolithe.html";
            }
                console.log('Vous avez cliqué sur : ' + (character.name));
        }

document.addEventListener('DOMContentLoaded', fetchData);

    </script>
</head>
<body><h1><u>Project Rebirth</u></h1>
    <!--Tableau central-->
        <table class="DanganTable" id="alpha" onload="displayData">
        </table>
        <div class="bottom_button">
            <input type="submit" value="Valider les morts" onClick="deadpeople(); return false;"/>
            <a href=electrolithe.html><button>Grotte Electrolithe</button></div></a>
        
    </body>
</html>